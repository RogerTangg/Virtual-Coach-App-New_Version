# Feature Specification: 虛擬健身教練互動應用 MVP (Virtual Coach App MVP)

**Feature Branch**: `001-virtual-coach-mvp`  
**Created**: 2025-11-14  
**Status**: Draft  
**Input**: User description: "虛擬健身教練互動應用 MVP - 包含內容管理、偏好設定、課表生成、訓練播放器四大核心功能"

## Clarifications

### Session 2025-11-14

- Q: 示範影片應該如何提供和儲存？ → A: 外部影片平台連結（YouTube/Vimeo）- 管理員提供 YouTube 或 Vimeo 等平台的嵌入連結。優點：零儲存成本、現成 CDN、管理員易操作；缺點：依賴外部平台可用性
- Q: 課表生成時，如何選擇和排序運動項目？ → A: 加權優先順序 - 根據運動屬性（如難度適配度、器材多樣性、肌群平衡）計算優先分數後選擇。優點：訓練品質最佳、符合運動科學；缺點：演算法複雜度高、需定義加權規則
- Q: MVP 上線時，運動資料庫至少應包含多少筆運動資料？ → A: 30-50 筆 - 每個主要偏好組合有 3-5 個選項。優點：足夠多樣性、內容準備工作量合理；缺點：仍需一定的內容準備時間

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 學員設定偏好並生成課表 (Trainee Preference Setup & Workout Generation) (Priority: P1)

學員開啟應用程式後，在主畫面選擇個人訓練偏好（運動目標、可用器材、總時長、難度），系統立即根據這些偏好從運動資料庫中篩選並生成一份客製化的訓練課表。

**Why this priority**: 這是 MVP 的核心價值主張，學員能立即獲得客製化課表是整個應用的基礎功能，沒有此功能應用程式無法提供任何價值。

**Independent Test**: 可透過以下步驟獨立測試：開啟應用 → 選擇偏好（例如：增肌、徒手、30分鐘、初階）→ 點擊生成按鈕 → 驗證課表包含符合所選標籤的運動項目且總時長接近 30 分鐘。

**Acceptance Scenarios**:

1. **Given** 學員首次開啟應用程式，**When** 在主畫面選擇運動目標為「增肌」、器材為「徒手」、時長為「30 分鐘」、難度為「初階」，並點擊「生成課表」按鈕，**Then** 系統應在 3 秒內顯示一份包含 5-8 個運動項目的課表，每個項目都包含動作名稱、時長、示範影片連結，且所有項目的標籤符合所選偏好。

2. **Given** 學員已生成一份課表，**When** 學員修改偏好（例如將時長改為「45 分鐘」）並重新生成，**Then** 系統應生成一份新課表，總時長接近 45 分鐘，且原課表被新課表取代。

3. **Given** 運動資料庫中沒有符合學員所選偏好的運動項目（例如選擇「增肌 + 徒手 + 高階」但資料庫中無此組合），**When** 學員點擊生成課表，**Then** 系統應顯示友善的錯誤訊息「目前資料庫中沒有符合您偏好的運動項目，請調整選項或稍後再試」，並允許學員重新選擇。

4. **Given** 學員選擇了多種器材（例如「徒手」和「啞鈴」），**When** 生成課表，**Then** 課表中可包含需要這兩種器材之一的運動項目，且明確標示每個項目所需器材。

---

### User Story 2 - 學員使用訓練播放器完成訓練 (Trainee Workout Player Execution) (Priority: P2)

學員生成課表後，進入全螢幕訓練播放器介面，系統按照課表順序逐一播放每個運動的示範影片，顯示倒數計時器，並在每個動作完成後自動切換至下一個動作，直到整份課表完成。

**Why this priority**: 播放器是學員實際執行訓練的核心工具，提供引導式體驗讓學員能跟著訓練。這是 P1 功能的自然延伸，確保學員不只能生成課表，還能實際執行。

**Independent Test**: 可透過以下步驟獨立測試：生成一份包含 3 個運動的課表 → 點擊「開始訓練」進入播放器 → 驗證播放器全螢幕顯示、依序播放每個運動的影片、顯示倒數計時、自動切換至下一個運動、完成後顯示結束畫面。

**Acceptance Scenarios**:

1. **Given** 學員已生成一份包含 5 個運動的課表，**When** 學員點擊「開始訓練」按鈕，**Then** 系統應進入全螢幕播放器模式，顯示第一個運動的動作名稱、說明、示範影片，並開始倒數計時（例如 60 秒）。

2. **Given** 播放器正在執行第一個運動且倒數計時進行中，**When** 倒數計時歸零，**Then** 系統應自動切換至第二個運動，顯示新的動作名稱、說明、影片，並重新開始倒數計時。

3. **Given** 播放器正在執行某個運動，**When** 學員點擊「暫停」按鈕，**Then** 倒數計時暫停，影片播放暫停（如適用），學員可點擊「繼續」恢復訓練。

4. **Given** 播放器正在執行某個運動，**When** 學員點擊「跳過」按鈕，**Then** 系統應立即切換至下一個運動，不等待倒數計時結束。

5. **Given** 播放器已完成最後一個運動，**When** 最後一個運動的倒數計時歸零，**Then** 系統應顯示訓練完成畫面，包含總訓練時間、完成的運動數量，並提供「返回主畫面」按鈕。

6. **Given** 播放器正在執行訓練，**When** 學員點擊「退出」按鈕，**Then** 系統應顯示確認對話框「確定要退出訓練嗎？進度將不會保存」，學員確認後返回主畫面。

---

### User Story 3 - 管理員管理運動資料庫 (Admin Exercise Database Management) (Priority: P3)

管理員透過 Supabase 的圖形化介面（Table Editor），直接新增、編輯、刪除運動資料（包含動作名稱、說明、影片連結、時長、標籤），無需撰寫任何程式碼。

**Why this priority**: 此功能是內容維護的基礎，允許管理員持續擴充和優化運動資料庫。雖然重要，但在 MVP 階段可以先由開發團隊手動建立初始資料，管理功能可稍後完善。

**Independent Test**: 可透過以下步驟獨立測試：登入 Supabase → 開啟 exercises 資料表 → 新增一筆運動資料（填寫所有欄位） → 驗證資料成功儲存 → 編輯該筆資料 → 驗證變更生效 → 刪除該筆資料 → 驗證資料已移除。

**Acceptance Scenarios**:

1. **Given** 管理員已登入 Supabase 並開啟 exercises 資料表，**When** 管理員點擊「新增資料列」並填寫欄位（name: "伏地挺身", description: "保持身體呈一直線", video_url: "https://example.com/pushup.mp4", duration_seconds: 60, tags: ["goal:增肌", "difficulty:初階", "equipment:徒手", "type:肌力"]），並儲存，**Then** 新運動資料應成功儲存至資料庫，學員在前端應用中能看到此運動。

2. **Given** 資料庫中已存在一筆運動資料，**When** 管理員編輯該筆資料（例如將 duration_seconds 從 60 改為 90），並儲存，**Then** 變更應立即生效，學員在前端生成課表時應看到更新後的時長。

3. **Given** 資料庫中已存在一筆運動資料，**When** 管理員刪除該筆資料，**Then** 該運動應從資料庫中移除，學員在前端生成課表時不再看到此運動。

4. **Given** 管理員正在新增或編輯運動資料，**When** 管理員未填寫必填欄位（如 name 或 duration_seconds）並嘗試儲存，**Then** Supabase 應顯示錯誤訊息，提示必填欄位不可為空。

5. **Given** 管理員正在新增或編輯標籤欄位，**When** 管理員輸入不符合格式的標籤（例如 "goal增肌" 而非 "goal:增肌"），**Then** 系統應接受該標籤（因 MVP 階段不強制驗證），但建議管理員遵循標準格式以確保前端篩選功能正常運作。

---

### User Story 4 - 學員查看課表詳情 (Trainee Workout Plan Review) (Priority: P4)

學員生成課表後、開始訓練前，可在課表預覽頁面查看完整的訓練計畫，包含所有運動項目、每個項目的動作名稱、說明、時長、所需器材，以便學員提前了解訓練內容。

**Why this priority**: 此功能提升使用者體驗，讓學員在開始訓練前有機會檢視和確認課表內容。非關鍵功能，可在 MVP 後期或後續版本加強。

**Independent Test**: 可透過以下步驟獨立測試：生成一份課表 → 在課表預覽頁面 → 驗證顯示所有運動項目的完整資訊（名稱、說明、時長、器材）→ 確認頁面提供「開始訓練」和「重新生成」按鈕。

**Acceptance Scenarios**:

1. **Given** 學員已生成一份包含 6 個運動的課表，**When** 課表生成完成後顯示預覽頁面，**Then** 頁面應以清單或卡片形式顯示所有 6 個運動項目，每個項目包含動作名稱、簡短說明、時長（秒數）、所需器材。

2. **Given** 學員正在查看課表預覽頁面，**When** 學員點擊某個運動項目，**Then** 系統應展開該項目的完整說明和注意事項，並可選擇性地顯示示範影片縮圖或連結。

3. **Given** 學員正在查看課表預覽頁面，**When** 學員對課表滿意並點擊「開始訓練」按鈕，**Then** 系統應進入播放器模式（User Story 2）。

4. **Given** 學員正在查看課表預覽頁面，**When** 學員對課表不滿意並點擊「重新生成」按鈕，**Then** 系統應返回偏好設定頁面，允許學員修改偏好並重新生成課表。

---

### Edge Cases

- **當運動資料庫為空時**：學員嘗試生成課表，系統應顯示「目前資料庫中沒有運動資料，請稍後再試」並通知管理員盡快新增內容。

- **當生成的課表總時長與學員選擇的時長差異過大**：例如學員選擇 30 分鐘，但符合條件的運動項目組合後總時長為 45 分鐘，系統應顯示「生成的課表時長為 45 分鐘，略高於您選擇的 30 分鐘，是否接受？」讓學員選擇接受或重新生成。

- **當學員在播放器執行訓練途中網路中斷**：如果外部影片平台（YouTube/Vimeo）連結失效或網路中斷，系統應顯示「影片載入失敗，請檢查網路連線」並提供「重試」或「跳過此項目」選項。若影片平台本身發生問題（如影片被移除、設為私人），應顯示「此影片暫時無法播放」並自動跳過。

- **當管理員刪除了正在被使用的運動資料**：如果學員正在執行某份課表，而管理員同時刪除了課表中的某個運動，播放器應跳過該運動並繼續下一個，或在該運動輪到時顯示「此運動資料已被移除，自動跳過」。

- **當學員選擇的偏好組合過於狹窄**：例如選擇「高階 + 減脂 + 彈力帶 + 15 分鐘」但資料庫中只有 1 個符合條件的運動，系統應顯示「符合條件的運動項目過少（僅 1 個），建議放寬條件以獲得更豐富的課表」。

- **當播放器執行超過預期時間**：如果學員暫停訓練超過 30 分鐘，系統可顯示提示「您已暫停較長時間，是否要繼續訓練？」避免學員忘記關閉應用。

---

## Requirements *(mandatory)*

### Functional Requirements

#### Epic 1: 內容管理 (CMS)

- **FR-001**: 系統必須提供一個 `exercises` 資料表，用於儲存所有運動資料。
- **FR-002**: 每筆運動資料必須包含以下欄位：`name`（動作名稱，文字）、`description`（動作說明/注意事項，文字）、`video_url`（示範影片連結，文字，支援外部影片平台如 YouTube 或 Vimeo 的嵌入連結）、`duration_seconds`（建議持續時間，整數，單位為秒）、`tags`（標籤陣列，用於篩選）。
- **FR-003**: 管理員必須能透過 Supabase Table Editor 對 `exercises` 資料表執行新增、編輯、刪除操作，無需撰寫程式碼。
- **FR-004**: 標籤欄位 `tags` 必須支援陣列格式，並建議遵循以下命名規則：`goal:增肌|減脂|塑形`、`difficulty:初階|中階|高階`、`equipment:徒手|啞鈴|彈力帶|壺鈴|etc`、`type:肌力|有氧|伸展`。
- **FR-005**: 系統應在資料表層級設定基本約束（如 `name` 和 `duration_seconds` 為必填欄位），防止管理員儲存不完整資料。
- **FR-005a**: 系統應驗證 `video_url` 欄位格式為有效的 YouTube 或 Vimeo 連結格式（可選驗證，MVP 階段可接受任何 URL 格式）。

#### Epic 2: 偏好設定 (Input)

- **FR-006**: 應用程式主畫面必須提供偏好設定介面，包含四個選項區域：運動目標、可用器材、總時長、難度偏好。
- **FR-007**: 「運動目標」必須以單選方式呈現，選項包含：增肌、減脂、塑形（可依需求擴充）。
- **FR-008**: 「可用器材」必須以多選方式呈現（複選框或標籤選擇），選項包含：徒手、啞鈴、彈力帶、壺鈴（可依需求擴充）。
- **FR-009**: 「總時長」必須以單選方式呈現（滑桿、下拉選單或按鈕組），選項包含：15 分鐘、30 分鐘、45 分鐘、60 分鐘。
- **FR-010**: 「難度偏好」必須以單選方式呈現，選項包含：初階、中階、高階。
- **FR-011**: 偏好設定介面必須提供「生成課表」按鈕，學員完成選擇後點擊即可觸發課表生成邏輯。
- **FR-012**: 系統必須在學員點擊生成按鈕前驗證所有必選項（運動目標、器材至少選一項、總時長、難度）是否已選擇，若有遺漏應提示「請完成所有選項」。

#### Epic 3: 課表生成 (Logic)

- **FR-013**: 系統必須根據學員選擇的偏好（運動目標、器材、難度），從 `exercises` 資料表中篩選出所有符合條件的運動項目（標籤匹配）。
- **FR-014**: 系統必須從篩選結果中組合出一份訓練課表，使用加權優先順序策略：根據運動屬性（難度適配度、器材多樣性、肌群平衡、運動類型分布）計算優先分數，優先選擇高分運動。課表的總時長應盡可能接近學員選擇的總時長（誤差範圍 ±10%）。
- **FR-014a**: 加權規則建議：難度完全匹配 +3 分、器材多樣化（避免連續相同器材）+2 分、肌群平衡（上下肢交替）+2 分、運動類型多樣（肌力與有氧混合）+1 分。具體加權值可在實作階段根據測試結果調整。
- **FR-015**: 課表生成演算法應避免重複相同的運動項目，除非篩選結果數量過少（少於 3 個）時可適度重複。
- **FR-016**: 課表生成應在 3 秒內完成，並將結果返回前端顯示。
- **FR-017**: 若篩選結果為空（無符合條件的運動），系統必須返回友善錯誤訊息「目前資料庫中沒有符合您偏好的運動項目，請調整選項或稍後再試」。
- **FR-018**: 若篩選結果數量過少（少於 3 個運動），系統應顯示警告訊息「符合條件的運動項目較少，建議放寬條件以獲得更豐富的課表」，但仍允許生成課表。

#### Epic 4: 訓練播放器 (Player)

- **FR-019**: 學員點擊「開始訓練」後，系統必須進入全螢幕播放器模式，隱藏其他 UI 元素（如導航列、側邊欄）。
- **FR-020**: 播放器必須按照課表順序，逐一顯示每個運動項目的資訊：動作名稱、說明/注意事項、示範影片（自動播放或循環播放）、倒數計時器。
- **FR-021**: 倒數計時器必須以視覺化方式（數字倒數、進度條或圓形進度條）顯示剩餘時間，並在時間歸零時自動切換至下一個運動。
- **FR-022**: 播放器必須提供「暫停/繼續」按鈕，學員點擊後倒數計時暫停，影片播放暫停（如適用），再次點擊後恢復。
- **FR-023**: 播放器必須提供「跳過」按鈕，學員點擊後立即切換至下一個運動，不等待倒數計時結束。
- **FR-024**: 播放器必須提供「退出」按鈕，學員點擊後顯示確認對話框「確定要退出訓練嗎？進度將不會保存」，確認後返回主畫面。
- **FR-025**: 當所有運動項目執行完畢後，播放器必須顯示訓練完成畫面，包含總訓練時間、完成的運動數量，並提供「返回主畫面」和「分享成績（選填）」按鈕。
- **FR-026**: 播放器應支援鍵盤快捷鍵（選填）：空白鍵暫停/繼續、右箭頭跳過、ESC 退出，提升桌面版使用體驗。

#### 跨功能需求 (Cross-Functional)

- **FR-027**: 應用程式必須為無須登入的單頁應用（SPA），學員開啟即可使用，無需註冊或登入流程。
- **FR-028**: 應用程式必須支援響應式設計，在手機、平板、桌面裝置上皆能正常顯示和操作。
- **FR-029**: 所有使用者介面文字、提示訊息必須以繁體中文為主，技術術語可輔以英文（格式：中文 (English)）。
- **FR-030**: 系統必須在關鍵操作（如生成課表、載入影片）時顯示載入狀態（Loading Spinner 或進度條），避免學員誤以為系統無回應。

### Key Entities

- **Exercise (運動)**：代表一個健身動作或訓練項目。關鍵屬性包含：動作名稱（name）、動作說明（description）、示範影片連結（video_url，外部影片平台如 YouTube/Vimeo）、建議時長（duration_seconds）、標籤（tags，用於分類和篩選）。每個 Exercise 是獨立的實體，可被多份課表引用。**資料規模**：MVP 上線時資料庫應包含 30-50 筆運動資料，確保每個主要偏好組合（目標 × 難度 × 器材）都有 3-5 個可選運動項目。

- **Workout Plan (訓練課表)**：代表根據學員偏好生成的一份訓練計畫。包含：運動項目清單（Exercise 的有序集合）、總時長、生成時間。WorkoutPlan 是臨時性實體，在前端生成後暫存於狀態管理或本地儲存，學員離開應用後不保留（MVP 階段無須持久化）。

- **Preference (偏好設定)**：代表學員當次訓練的選擇。包含：運動目標（goal）、可用器材清單（equipment）、總時長（duration）、難度（difficulty）。Preference 是輸入型實體，用於篩選和生成 WorkoutPlan。

- **Training Session (訓練執行)**：代表學員在播放器中執行訓練的過程。包含：當前執行的運動索引、已完成的運動數量、已耗費時間、播放狀態（播放中、暫停、已完成）。TrainingSession 是前端運行時狀態，無須持久化（MVP 階段）。

---

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 學員能在 60 秒內完成偏好設定並成功生成一份課表（從開啟應用到看到課表結果）。
- **SC-002**: 課表生成的響應時間必須在 3 秒內（從點擊「生成課表」到顯示結果）。
- **SC-003**: 生成的課表總時長與學員選擇的時長誤差必須在 ±10% 以內（例如選擇 30 分鐘，課表時長應在 27-33 分鐘之間）。
- **SC-004**: 播放器能流暢執行完整訓練流程，倒數計時準確（誤差 ±1 秒），運動項目自動切換無延遲（切換時間 <1 秒）。
- **SC-005**: 90% 的學員能在首次使用時，無需外部指引即可完成偏好設定、生成課表、開始訓練三個核心操作（可透過使用者測試驗證）。
- **SC-006**: 應用程式在手機、平板、桌面裝置上的首次內容繪製時間（FCP）必須低於 1.5 秒，最大內容繪製時間（LCP）必須低於 2.5 秒。
- **SC-007**: 管理員能在 5 分鐘內透過 Supabase 新增 10 筆運動資料（平均每筆 30 秒），無需技術支援。MVP 上線前應準備 30-50 筆初始運動資料（估計 1-2 天內容準備時間）。
- **SC-008**: 播放器影片載入失敗率必須低於 5%（可透過 CDN 優化和錯誤處理降低）。
- **SC-009**: 學員對訓練體驗的滿意度評分達到 4.0/5.0 以上（可在訓練完成後透過簡易評分機制收集，選填功能）。
- **SC-010**: MVP 上線後，70% 的學員能完成至少一次完整訓練（從生成課表到播放器顯示訓練完成畫面）。
